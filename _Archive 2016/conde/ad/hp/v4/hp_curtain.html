<html>
<head>

  <meta charset="UTF-8">
  <title>Architectural Digest</title>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src='http://cdnjs.cloudflare.com/ajax/libs/react/0.13.2/react.js'></script>
  
  <script>
    /*!
    Copyright (c) 2015 Jed Watson.
    Licensed under the MIT License (MIT), see
    http://jedwatson.github.io/classnames
    */

    function classNames () {
      'use strict';

      var classes = '';

      for (var i = 0; i < arguments.length; i++) {
        var arg = arguments[i];
        if (!arg) continue;
        var argtype = typeof arg;

        if ('string' === argtype || 'number' === argtype) {
          classes += ' ' + arg;

        } else if (Array.isArray(arg)) {
          classes += ' ' + classNames.apply(null, arg);

        } else if ('object' === argtype) {
          for (var key in arg) {
            if (arg.hasOwnProperty(key) && arg[key]) {
              classes += ' ' + key;
            }
          }
        }
      }

      return classes.substr(1);
    }


    $(function () {
      
      'use strict';

      // Simplest possible mixin to get a global scroll event
      var WindowScrollMixin = {
          componentDidMount: function() {
              window.addEventListener('scroll', this.onScroll, false);
          },
          componentWillUnmount: function() {
              window.removeEventListener('scroll', this.onScroll, false);
          }
      };

      // If we don't get a scroll event within 200 ms, assume the user
      // stopped scrolling.
      var SCROLL_TIMEOUT = 120;
      var CHECK_INTERVAL = SCROLL_TIMEOUT / 6;

      var PageScrollMixin = {

        mixins: [WindowScrollMixin],
        
        checkInterval: null,
        scrolling: false,
        proxiedScrollTime: Date.now(),
        
        componentDidMount: function() {
          this.checkInterval = window.setInterval(this.checkScroll, CHECK_INTERVAL);
          this.scrolling = false;
        },

        componentWillUnmount: function() {
          window.clearInterval(this.checkInterval);
        },

        checkScroll: function() {
          if (Date.now() - this.lastScrollTime > SCROLL_TIMEOUT && this.scrolling) {
            this.scrolling = false;
            this.onScrollEnd();
          }
        },
        
        proxiedScroll: function () {
          if (Date.now() - this.proxiedScrollTime > CHECK_INTERVAL && this.scrolling ) {
            this.proxiedScrollTime = Date.now();
            this.onScrollProxy();
          }
        },

        onScroll: function() {
          if (!this.scrolling) {
            this.scrolling = true;
            this.onScrollStart();
          }
          this.lastScrollTime = Date.now();
          this.proxiedScroll();
        }
      };


      /**
       * Stickybox React component
       * @class
       */
      var Parallax = React.createClass({
        render: function () {
          var children = React.Children.map(
            this.props.children,
            function(child, idx) {
              var offset = !idx ? 64 : 0;
              return React.createElement(Stickybox, {className: 'card', idx: idx, offset: offset}, child);
            }
          );
          return React.createElement('div', {className: 'parallax'}, children);
        }
      });


      /**
       * Stickybox React component
       * @class
       */
      var Stickybox = React.createClass({

        mixins: [PageScrollMixin],

        node: null,
        
        getDefaultProps: function () {
          return {
            offset: 0
          }
        },

        getInitialState: function () {
          return {
            top: 1,
            height: -1,
            scrolling: false
          };
        },
        
        componentDidMount: function () {
          this.node = this.getDOMNode();
          this.updateTopPosition();
        },

        handleScroll: function () {
          this.updateTopPosition();
        },

        updateTopPosition: function () {
          var box = this.node.getBoundingClientRect();
          this.setState({
            top: box.top,
            height: box.height
          });
        },
        
        onScrollStart: function() {
          this.setState({scrolling: true});
          this.handleScroll();
        },
        
        onScrollProxy: function () {
          this.handleScroll();
        },
        
        onScrollEnd: function() {
          this.setState({scrolling: false});
          this.handleScroll();
        },

        getState: function () {
          return this.state;
        },

        isFrozen: function () {
          console.log('TOP ' + this.props.idx + ' - ' + this.state.top, this.state.top < (1 + this.props.offset) && this.state.top < (this.props.offset + window.document.body.scrollTop));
          return this.state.top < (1 + this.props.offset) && this.state.top < (this.props.offset + window.document.body.scrollTop);
        },

        /**
         * Render
         * @returns {ReactElement} react element
         */
        render: function () {
          var args = {}, isFrozen = this.isFrozen();

          args.className = classNames('component-stickybox', {
            frozen: isFrozen
          });
          args.style = {
            height: isFrozen ? this.state.height : 'auto',
            zIndex: this.props.idx
          };
          return React.createElement('div', args, 
              this.props.children);
        }
      });

      var parallaxWithContent = React.createElement(Parallax, {index: 0}, 
        React.createElement('img', {className: 'section1', src: 'img/Card11.jpg'}),
        React.createElement('img', {className: 'sectionad', src: 'img/ad-440w.png'}), 
        React.createElement('img', {className: 'section2', src: 'img/Card2.jpg'}), 
        React.createElement('img', {className: 'section2', src: 'img/Card3.jpg'}));

      var content = React.createElement('div', null, 
            React.createElement('img', {src: 'http://www.yaya-wang.com/conde/ad/hp/v5/img/nav.png'}),
            React.createElement(Stickybox, null, React.createElement('div', {className: 'nav'}, React.createElement('img', {src: 'http://www.yaya-wang.com/conde/ad/hp/v5/img/sticky0.png'})), React.createElement('div', {className: 'mininav'}, React.createElement('img', {src: 'http://www.yaya-wang.com/conde/ad/hp/v4/img/sticky.png'}))), 
           parallaxWithContent, React.createElement('img', {className: 'content', src: 'http://www.yaya-wang.com/conde/ad/hp/v5/img/Feed.jpg'}));

      React.render(content, document.getElementById('parallax'));
    });
  </script>

  <style>
      body {
      margin: 0 auto;
    }

    .center {
      margin: 0 auto;
      width: 1400px;
    }

    .center img {
      width: 100%;
    }

    .component-stickybox > * {
      margin: 0;
      padding: 0;
      top: 64px;
      width: 1400px;
      background-color: #fff;
    }
    
    .component-stickybox.frozen > * {
      position: fixed;
      top: 0;
      z-index: -1;
      width: 1400px;
      background-color: #fff;
    }
    
    .component-stickybox.frozen .section1 {
      margin-top: 64px;
    }

    .sectionad {
      margin-top: 38px;
      margin-bottom: -10px;
    }

    .section2 {
      background-color: #fff; 
      margin: 0;
      padding-top: 64px;
    }
    
    .nav {
      height: 68px;
    }
    .nav img {
      box-shadow: 0 4px 5px 0 rgba(85, 85, 85, .1);
    }
    .mininav {
      display: none;
    }

    .frozen .mininav {
      display: block;
      z-index: 999;
      box-shadow: 0 4px 5px 0 rgba(85, 85, 85, .1);
    }

    .content {
      padding-top: 64px;
      position: relative;
      margin-bottom: -60px;
    }
    </style>

</head>


<body>

  <div class="center">
    <div id="parallax">
    </div>
  </div>

  <div class="content">
  </div>

</body>
</html>